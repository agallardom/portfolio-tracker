generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Portfolio {
  id           String        @id @default(uuid())
  name         String
  currency     String        // "USD" or "EUR"
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  transactions Transaction[]
}

model Asset {
  symbol            String        @id
  name              String?
  currentPrice      Float?        // Price in quote currency
  quoteCurrency     String?       // Currency the asset trades in (EUR, USD, etc.)
  exchangeRateToUSD Float?        // Exchange rate to USD
  exchangeRateToEUR Float?        // Exchange rate to EUR
  updatedAt         DateTime      @updatedAt
  transactions      Transaction[]
}

model Transaction {
  id           String   @id @default(uuid())
  date         DateTime
  type         String   // "BUY", "SELL", "DIVIDEND", "SAVEBACK", "ROUNDUP", "GIFT"
  
  // Amounts in portfolio currency
  amount       Float    // Total value in portfolio currency
  currency     String   // Portfolio currency (should match Portfolio currency)
  
  // Asset info (optional for SaveBack etc)
  assetSymbol  String?
  asset        Asset?   @relation(fields: [assetSymbol], references: [symbol])
  
  // Price and quantity
  pricePerUnit Float?   // Price per unit in portfolio currency
  quantity     Float?
  
  fee          Float?   @default(0)
  
  // Multi-currency transaction data
  exchangeRate Float?   @default(1.0) 
  originalCurrency String?  // Currency used for the transaction (e.g., EUR)
  originalAmount   Float?   // Amount in original currency
  
  // Asset-specific currency tracking
  assetCurrency              String?  // Currency the asset trades in (e.g., EUR for SAN.MC)
  pricePerUnitInAssetCurrency Float?  // Price per unit in asset's native currency

  // Dividend Tax Details
  withholdingTax Float?   // Tax withheld in portfolio currency
  taxRate        Float?   // Tax rate percentage (e.g. 19.0)
  isin           String?  // ISIN code of the asset

  portfolioId  String
  portfolio    Portfolio @relation(fields: [portfolioId], references: [id])

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
